<h1 class="text-2xl mt-4 text-secondary">
  Dashboard
</h1>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="ml-2 mt-4 lg:mt-0">
  <div class="d-flex flex-wrap">
    <% @graphs.each_with_index do |graph, i| %>
      <div class="<%= '' if [0,1].include?(i) %>">
        <canvas id="chart<%= i %>"></canvas>
      </div>
      <script>
        // Les données pour chaque graphique sont générées directement en Ruby
        const data<%= i %> = {
          labels: <%= @results[i].keys.to_json.html_safe %>,
          datasets: [
            {
              label: "<%= "#{graph.filter ? graph.filter.get_filtered_records.count : graph.table.size}  #{graph.table.name_pluralized}" %>",
              backgroundColor: [
                'rgb(255, 99, 132)',
                'rgb(75, 192, 192)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)',
                "hsl(252, 82.9%, 67.8%)",
                'rgb(255,159,64)',
                'rgb(201, 203, 207)',
              ],
              data: <%= @results[i].values.to_json.html_safe %>,
            },
          ],
        };

        const configChart<%= i %> = {
          type: "<%= graph.chart_type %>",
          data: data<%= i %>,
          options: {},
        };

        // Initialisation du graphique pour l'élément correspondant
        const chartElement<%= i %> = document.getElementById("chart<%= i %>");
        if (chartElement<%= i %>) {
          new Chart(chartElement<%= i %>, configChart<%= i %>);
        }
      </script>
    <% end %>
  </div>
</div>