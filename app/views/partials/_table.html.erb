<div class="overflow-x-auto">
  <table class="table table-hover border align-middle">
    <thead>
      <tr class="table-light" style="vertical-align: middle">
        <% table.fields.listable.ordered.each_with_index do | field, index | %>
          <%= render partial: 'partials/table_header_cell', locals: {table:, field:, index:} %>
        <% end %>
        <th>
          <%= link_to url_for(params.permit!.merge(sort_by: 0)), class:'text-decoration-none d-flex gap-2' do %>
            <span class="material-symbols-outlined text-black-50">
              update
            </span>
            <span class="text-nowrap text-black">
              <%= t('scaffold.updated_at') %>
              <% if params[:sort_by] == '0' %>
                <span class="text-decoration-none text-black-50"><%= (session[:order_by] == 'ASC') ? '△' : '▽' %></span>
              <% end %>
            </span>
          <% end %>
        </th>
        <th></th>
      </tr>
    </thead>

    <% unless records.size.zero? %>
      <% @records_size = 0 %>
      <tbody>
        <% records.each do | record_index | %>
          <%= render partial: 'partials/table_row', locals: {table:, record_index:}  %>
        <% end %>
      </tbody>

      <% if table.fields.listable.where.not(operation: nil).any? %>
        <tfoot>
          <tr>
            <% table.fields.listable.ordered.each do |field| %>
              <%= render partial: 'partials/table_footer_cell', locals: {field:} %>
            <% end %>
            <td colspan=2></td>
          </tr>
        </tfoot>
      <% end %>
    <% end %>
  </table>
</div>
<% if %w[show_details related_tables].include?(action_name) %>
  <% if policy(table).fill? || current_user.compte_démo? %>
    <%= link_to "(+) #{table.name}", fill_path(table, relation: @relation, value: @record_index), class: 'btn btn-outline-primary mb-4', data: { turbo_frame: "_top" }  %>
  <% end %>
<% end %>
<div class="d-flex flex-wrap align-items-center justify-content-end gap-2">
  <p class="flex-fill mb-0">
    <%= t('pagination.display_of') %>
    <%= @records_size || '0' %>
    <%= table.name.pluralize(@records_size) %>
    
    <% if action_name == 'show' %>
      <%= t('pagination.total', records_count: @records.size) %>
    <% end %>
  </p>
  <% if action_name != 'show_details' %>
    <div class="d-block">
      <!-- TODO : faire une boucle pour avoir moins de code répétitif -->
      <%= link_to url_for(params.merge(format: :xls)), class: 'btn btn-outline-success btn-sm', title: "#{t('tables.export', table_name: table.name, export_format: "XLS" )}" do %>
        XLS
      <% end %>
      <%= link_to url_for(params.merge(format: :csv)), class: 'btn btn-outline-primary btn-sm', title: "#{t('tables.export', table_name: table.name, export_format: "CSV" )}" do %>
        CSV
      <% end %>
      <%= link_to url_for(params.merge(format: :pdf)), class: 'btn btn-outline-danger btn-sm', title: "#{t('tables.export', table_name: table.name, export_format: "PDF" )}" do %>
        PDF
      <% end %>
    </div>
  <% end %>
</div>